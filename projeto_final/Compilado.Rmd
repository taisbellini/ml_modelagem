---
title: "Trabalho Final - Compilado de Métodos"
output: html_notebook
---
# Introdução

$~$

Carregando os dados:

```{r}
data <- readxl::read_xlsx("drug_consumption_dataset.xlsx")
head(data)

```

$~$

Excluindo as variáveis não relevantes para a análise:

```{r}
data <- subset(data, select=-c(Impulsive, SS))
head(data) 
```

$~$

Convertando os Scores em Categorias:

```{r}
scores = c("NScore", "EScore", "OScore", "AScore", "CScore")

for(col in scores){
  for (row in 1:nrow(data)){
    if(data[row, col] < 35){
      data[row, col] = "Very Low"
    }
    else if(data[row, col] < 45){
      data[row, col] = "Low"
    }
    else if(data[row, col] < 55){
      data[row, col] = "Average"
    }
    else if(data[row, col] < 65){
      data[row, col] = "High"
    }
    else {
      data[row, col] = "Very High"
    }
  }
}

head(data)
```

$~$

Classificando os usuários e não-usuários das drogas escolhidas de acordo com o que foi previamente definido pelo grupo:

Não usuário: {Never Used, Used Over a Decade ago, Used in the Last Decade}
Usuário: {Used in Last Year, Used in Last Month, Used in Last Week, Used in Last Day}

Drogas a serem analisadas: Alcool, Ecstasy, Cannabis, Estimulantes: {Cokes, Crack, Anfetamina}

```{r}
data <- transform(data, alcohol_user = 
                    ifelse((Alcohol == "Never Used" | 
                              Alcohol == "Used over a Decade Ago" | 
                              Alcohol == "Used in Last Decade"), 0, 1))

data <- transform(data, ecstasy_user = 
                    ifelse((Ecstasy == "Never Used" | 
                              Ecstasy == "Used over a Decade Ago" | 
                              Ecstasy == "Used in Last Decade"), 0, 1))


data <- transform(data, cannabis_user = 
                    ifelse((Cannabis == "Never Used" | 
                              Cannabis == "Used over a Decade Ago" | 
                              Cannabis == "Used in Last Decade"), 0, 1))


data <- transform(data, stimulating_user = 
                    ifelse((
                      (Cokes == "Never Used" | 
                         Cokes == "Used over a Decade Ago" | 
                         Cokes == "Used in Last Decade") &
                        (Crack == "Never Used" | 
                           Crack == "Used over a Decade Ago" | 
                           Crack == "Used in Last Decade") &
                        (Amphet == "Never Used" | 
                           Amphet == "Used over a Decade Ago" | 
                           Amphet == "Used in Last Decade")), 0, 1))
head(data)
```

$~$

Introdução de variáveis dummy caso o modelo precise:
```{r}
install.packages("fastDummies")
library(fastDummies)

data_dummy <- dummy_cols(data, remove_selected_columns = TRUE)
head(data_dummy)
```

Exportando os dados: 

```{r}
write.csv2(data, file="drug_use_data.csv")
write.csv2(data_dummy, file="drug_use_data_dummy.csv")
```



$~$

Divisão dos dados entre treino e teste:
```{r}

# Funcao para dividir dados aleatoriamente em treinamento e teste #
split_data = function(data, train_perc){
  train_size <- floor(train_perc * nrow(data))
  train_index <- sample(seq_len(nrow(data)), size = train_size)
  train <- data[train_index, ]
  test <- data[-train_index, ]
  return(list("train" = train,
              "test" = test))
}

#usage: 
set.seed(205650)
splitted_data <- split_data(data, 0.85)
train <- splitted_data$train
test <- splitted_data$test

```

$~$

#Análise de Clusters com k-modes

```{r}
install.packages("klaR")
library(klaR)

foco <- data[2:6]
foco['Cannabis'] <- data$Cannabis

set.seed(111)

km2 = kmodes(foco, 2)
km2

library(plyr)
clusters <- km2$cluster
foco['cluster'] <- clusters

classes <- unique(foco$Cannabis)
for(class in classes){
  subdf <- subset(foco, Cannabis == class)
  cont = count(subdf['cluster'])
  cont$freq = 100*cont$freq/nrow(subdf)
  print(class)
  print(cont)
}

```


# TO DO: Métodos de Classificação

to do: adicionar métodos de classificação  
to do? adicionar clusterização?
